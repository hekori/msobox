C        Generated by TAPENADE     (INRIA, Tropics team)
C  Tapenade 3.6 (r4343) - 10 Feb 2012 10:52
C
C  Differentiation of ffcn in forward (tangent) mode: (multi-directional mode)
C   variations   of useful results: f
C   with respect to varying inputs: p u x
C   RW status of diff variables: f:out p:in u:in x:in
C ===============================================================================
C
C fortran ffcn for the chemical reaction example
C
C 	x1_dot = - u * x1 + u ** 2 * x2
C 	x2_dot = u * x1 - p * u ** 2 * x2
C   
C 	0 < u < 1 
C 
C ===============================================================================
C
      SUBROUTINE FFCN_D_XPU_V(t, x, x_d, f, f_d, p, p_d, u, u_d, nbdirs)
      IMPLICIT NONE
C
      INCLUDE 'DIFFSIZES.inc'
C  Hint: nbdirsmax should be the maximum number of differentiation directions
C
      DOUBLE PRECISION x(2), f(2), p(1), u(1), t
      DOUBLE PRECISION x_d(nbdirsmax, 2), f_d(nbdirsmax, 2), p_d(
     +                 nbdirsmax, 1), u_d(nbdirsmax, 1)
      INTEGER nd
      INTEGER nbdirs
      INTEGER ii1
      DO nd=1,nbdirs
        DO ii1=1,2
          f_d(nd, ii1) = 0.D0
        ENDDO
        f_d(nd, 1) = 2*u(1)*u_d(nd, 1)*x(2) - u(1)*x_d(nd, 1) - u_d(nd, 
     +    1)*x(1) + u(1)**2*x_d(nd, 2)
        f_d(nd, 2) = u_d(nd, 1)*x(1) + u(1)*x_d(nd, 1) - (p_d(nd, 1)*x(2
     +    )+p(1)*x_d(nd, 2))*u(1)**2 - p(1)*x(2)*2*u(1)*u_d(nd, 1)
      ENDDO
C
      f(1) = -(u(1)*x(1)) + u(1)**2*x(2)
      f(2) = u(1)*x(1) - p(1)*u(1)**2*x(2)
      END
C
C ===============================================================================

